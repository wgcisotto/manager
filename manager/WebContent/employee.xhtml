<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:decorate template="default.xhtml">
        <ui:define name="header">
          Funcionário
        </ui:define>
        <ui:define name="default">
        
          <p:messages id="msgEmployee" showDetail="true" autoUpdate="true" closable="true" />
         
         <p:panelGrid id="pngEmp" columns="1" styleClass="panelgrid_sem_borda">
	         
	         <p:panelGrid id="pngControleEmp" columns="3" styleClass="panelgrid_sem_borda"> 
	          <h:commandButton id="btnOpendlgEmp" styleClass="btn btn-primary btn-lg" value="Novo Funcionario">
	            <p:ajax event="click" oncomplete="PF('dlgEmp').show();" listener="#{company.newEmployee}" update="pngNewEmp" />
	          </h:commandButton>
	         </p:panelGrid>          
                              
          <p:dataTable id="dtbEmp" widgetVar="dtbEmp" var="emp" value="#{company.employees}" emptyMessage="Nenhum Funcionario encontrado" 
              selectionMode="single" rowKey="#{emp.id_employee}" filteredValue="#{company.filteredEmployees}">
     
              <p:ajax event="rowSelect" listener="#{company.onRowSelectEmployee}" update="@form"/>
 
              <f:facet name="header">
                  <p:outputPanel id="dtbHeader" styleClass="search_align">
                      <h:outputText value="Search: " />
                      <p:inputText id="globalFilter" onkeyup="PF('dtbEmp').filter()" value="#{company.globalFilterEmployee}" style="width:150px" placeholder="Digite"/>
                  </p:outputPanel>
              </f:facet>
 
              <p:column sortBy="#{emp.name}" filterBy="#{emp.name}" filterMatchMode="contains">
                <p:panelGrid columns="1" styleClass="panelgrid_sem_borda">
                <p:panelGrid columns="3" styleClass="panelgrid_sem_borda">
                  <p:column>
                    <p:commandButton  styleClass="btn_opcoes"  icon="ui-icon-person"  />
                    <h:outputText value="#{emp.name}" />
                  </p:column>
                  <p:column>
                    <p:commandButton styleClass="btn_opcoes"  icon="ui-icon-suitcase"  />
                    <h:outputText value="#{emp.branch.name}" rendered="#{emp.branch != null}" />
                    <h:outputText value="Administrador" rendered="#{emp.branch == null}" />
                  </p:column>
                 <p:column style="float: right;" >
                   <p:commandButton id="btnOpendlgEdit" title="Editar" style="float: right" styleClass="btn_opcoes" icon="ui-icon-pencil" disabled="#{company.selectedEmployee == null}" oncomplete="PF('dlgEmpEdit').show();" process="@this"/>
                   <p:commandButton id="btnDelEmp" styleClass="btn_opcoes" icon="ui-icon-close" style="float: right" disabled="#{company.selectedEmployee == null}" action="#{company.delEmployee}" oncomplete="PF('dtbEmp').unselectAllRows();" update="@form"/>
                 </p:column>
                </p:panelGrid>
                <p:panelGrid columns="1">
                  <p:column>
	                  <p:commandButton  styleClass="btn_opcoes"  icon="ui-icon-contact"  />
	                  <p:outputLabel value="#{emp.phone}"/>
                  </p:column>
                  <p:column>
                    <p:commandButton  styleClass="btn_opcoes"  icon="ui-icon-home" />
	                  <p:outputLabel value="#{emp.address.street} - #{emp.address.number} - #{emp.address.district} - #{emp.address.city} - #{emp.address.state}"/>
                  </p:column>
                </p:panelGrid>
                </p:panelGrid>
                <f:facet name="filter">
                  <h:inputText style="display:none;"/>
                </f:facet>
              </p:column>
          </p:dataTable>   
         </p:panelGrid>
         
         
         <p:dialog id="dlgEmp" header="Cadastro de Funcionário" widgetVar="dlgEmp" minHeight="40" resizable="false" modal="true">
          <p:panelGrid id="pngNewEmp" columns="1" styleClass="panelgrid_sem_borda">
            <p:growl id="growlDlgEmp" sticky="true" showDetail="true" life="3000" />
              <p:fieldset>
		           <p:panelGrid columns="1" styleClass="panelgrid_sem_borda">
		             <p:outputLabel value="ID: "/>
		             <p:inputText value="#{company.newEmployee.id_employee}"  styleClass="inputTextDisabled" size="10" disabled="true"/>
		             <p:outputLabel value="Nome: "/>
		             <p:inputText value="#{company.newEmployee.name}" size="55" required="true" requiredMessage="Preencha o nome do funcionario"/>      
		             <p:outputLabel value="Telefone: "/>
		             <p:inputText value="#{company.newEmployee.phone}" size="13" required="true" requiredMessage="Preencha o telefone do funcionario"/>
		           </p:panelGrid>
		           <p:panelGrid columns="3" styleClass="panelgrid_sem_borda">
		             <p:outputLabel value="Endereço: "/>
                 <p:outputLabel value="Numero: "/>
                 <p:outputLabel value="CEP: "/>
                 <p:inputText value="#{company.newEmployee.address.street}" size="53" />
                 <p:inputText value="#{company.newEmployee.address.number}" size="10" />
                 <p:inputText value="#{company.newEmployee.address.zip_code}" size="10" />
		           </p:panelGrid>
		           <p:panelGrid columns="3" styleClass="panelgrid_sem_borda">
		             <p:outputLabel value="Bairro:"/>
		             <p:outputLabel value="Cidade:"/>
		             <p:outputLabel value="Estado: "/>
                 <p:inputText value="#{company.newEmployee.address.district}" size="35" />
                 <p:inputText value="#{company.newEmployee.address.city}" size="35" />
                 <p:inputText value="#{company.newEmployee.address.state}" size="3" />
		           </p:panelGrid>
		           <p:panelGrid columns="2" styleClass="panelgrid_sem_borda">
		             <p:outputLabel value="Email: "/>
		             <p:outputLabel value="Senha Default: "/>
		             <p:inputText value="#{company.newEmployee.user}" size="55" />
                 <p:inputText value="#{company.newEmployee.pass}" size="15" />
		           </p:panelGrid>
		           <p:panelGrid id="pngProfileNew" columns="2" styleClass="panelgrid_sem_borda">
		            <p:outputLabel value="Perfil: "/>
		            <p:outputLabel value="Filial: " rendered="#{company.newEmployee.profile.name ne 'Administrador' and  company.newEmployee.profile != null}"/>
				        <p:selectOneRadio id="rdbProfileNew" value="#{company.newEmployee.profile}" converter="profileConverter">
				            <f:selectItems value="#{company.profiles}" itemLabel="#{p.name}" itemValue="#{p}" var="p"/>
				            <p:ajax event="change" update="pngProfileNew" />
				        </p:selectOneRadio>
				        <p:selectOneMenu id="slctBranch" value="#{company.newEmployee.branch}" converter="branchConverter" 
				          rendered="#{company.newEmployee.profile.name ne 'Administrador' and  company.newEmployee.profile != null}">
				           <f:selectItems value="#{company.branchs}" var="b" itemLabel="#{b.name}" itemValue="#{b}"/>
				        </p:selectOneMenu>
		           </p:panelGrid>
		         </p:fieldset>
            <f:facet name="footer">
            
              <p:panelGrid columns="2" style="float: right;">
              
                <h:commandButton styleClass="btn btn-primary" value="Incluir">
                  <p:ajax event="click" listener="#{company.addEmployee}" process="@this pngNewEmp"  oncomplete="handleAddEmpRequest(xhr, status, args)" update="dtbEmp growlDlgEmp" />
                </h:commandButton>
                
                <h:commandButton styleClass="btn btn-default" value="Cancelar">
                  <f:setPropertyActionListener value="null" target="{company.newEmployee}"/> 
                  <p:ajax event="click" oncomplete="PF('dlgEmp').hide();" />
                </h:commandButton>
                
              </p:panelGrid>
               
            </f:facet>
         </p:panelGrid>
        </p:dialog>
         
         <p:dialog id="dlgEmpEdit" header="Edicao de Funcionario " widgetVar="dlgEmpEdit" minHeight="40" resizable="false" modal="true">
          <p:growl id="growlDlgEmployeeEdit" sticky="true" showDetail="true" life="3000" />
          <p:panelGrid id="pngEmployeeEdit" columns="1" styleClass="panelgrid_sem_borda">
            <p:fieldset>
               <p:panelGrid columns="1" styleClass="panelgrid_sem_borda">
                 <p:outputLabel value="ID: "/>
                 <p:inputText value="#{company.selectedEmployee.id_employee}"  styleClass="inputTextDisabled" size="10" disabled="true"/>
                 <p:outputLabel value="Nome: "/>
                 <p:inputText value="#{company.selectedEmployee.name}" size="55" required="true" requiredMessage="Preencha o nome do funcionario"/>      
                 <p:outputLabel value="Telefone: "/>
                 <p:inputText value="#{company.selectedEmployee.phone}" size="13" required="true" requiredMessage="Preencha o telefone do funcionario"/>
               </p:panelGrid>
               <p:panelGrid columns="3" styleClass="panelgrid_sem_borda">
                 <p:outputLabel value="Endereço: "/>
                 <p:outputLabel value="Numero: "/>
                 <p:outputLabel value="CEP: "/>
                 <p:inputText value="#{company.selectedEmployee.address.street}" size="53" />
                 <p:inputText value="#{company.selectedEmployee.address.number}" size="10" />
                 <p:inputText value="#{company.selectedEmployee.address.zip_code}" size="10" />
               </p:panelGrid>
               <p:panelGrid columns="3" styleClass="panelgrid_sem_borda">
                 <p:outputLabel value="Bairro:"/>
                 <p:outputLabel value="Cidade:"/>
                 <p:outputLabel value="Estado: "/>
                 <p:inputText value="#{company.selectedEmployee.address.district}" size="35" />
                 <p:inputText value="#{company.selectedEmployee.address.city}" size="35" />
                 <p:inputText value="#{company.selectedEmployee.address.state}" size="3" />
               </p:panelGrid>
               <p:panelGrid columns="2" styleClass="panelgrid_sem_borda">
                 <p:outputLabel value="Email: "/>
                 <p:outputLabel value="Senha Default: "/>
                 <p:inputText value="#{company.selectedEmployee.user}" size="55" />
                 <p:inputText value="#{company.selectedEmployee.pass}" size="15" />
               </p:panelGrid>
               <p:panelGrid id="pngProfileEdit" columns="2" styleClass="panelgrid_sem_borda">
                <p:outputLabel value="Perfil: "/>
                <p:outputLabel value="Filial: " rendered="#{company.selectedEmployee.profile.name ne 'Administrador' and  company.selectedEmployee.profile != null}"/>
                <p:selectOneRadio id="rdbProfileEdit" value="#{company.selectedEmployee.profile}" rendered="#{company.selectedEmployee.profile != null}" converter="profileConverter">
                    <f:selectItems value="#{company.profiles}" itemLabel="#{p.name}" itemValue="#{p}" var="p"/>
                    <p:ajax event="change" update="pngProfileEdit" />
                </p:selectOneRadio>
                <p:selectOneMenu id="slctBranchEdit" value="#{company.selectedEmployee.branch}" converter="branchConverter"
                  rendered="#{company.selectedEmployee.profile.name ne 'Administrador' and  company.selectedEmployee.profile != null}">
                   <f:selectItems value="#{company.branchs}" var="b" itemLabel="#{b.name}" itemValue="#{b}"/>
                </p:selectOneMenu>
               </p:panelGrid>
            </p:fieldset>
            <f:facet name="footer">
              <p:panelGrid columns="2" style="float: right;">
                <h:commandButton styleClass="btn btn-primary" value="Editar">
                  <p:ajax event="click" listener="#{company.updateEmployee}" process="@this pngEmployeeEdit"  oncomplete="handleEditEmpRequest(xhr, status, args)" update="pngEmployeeEdit dtbEmp growlDlgEmployeeEdit pngControleEmp" />
                </h:commandButton>
                <h:commandButton styleClass="btn btn-default" value="Cancelar">
                  <p:ajax event="click" oncomplete="PF('dlgEmpEdit').hide();" />
                </h:commandButton>
              </p:panelGrid>  
            </f:facet>
         </p:panelGrid>
        </p:dialog>
       
       
       
       <script type="text/javascript">
          function handleAddEmpRequest(xhr, status, args) {
              if(args.validationFailed) {
                  PF('dlgEmp').jq.effect("shake", {times:2}, 100);
              }
              else {
                  PF('dlgEmp').hide();
               
              }
          }
          function handleEditEmpRequest(xhr, status, args) {
              if(args.validationFailed) {
                  PF('dlgEmpEdit').jq.effect("shake", {times:2}, 100);
              }
              else {
                  PF('dtbEmp').unselectAllRows();
                  PF('dlgEmpEdit').hide();
               
              }
          } 
        </script>
       
         
         
        </ui:define>
    </ui:decorate>
</html>